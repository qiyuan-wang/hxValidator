/*! hxValidator 
* v0.1.0 
* 2014-09-22
*  http://www.huxiu.com
* Copyright (c) 2014 zisasign; Licensed MIT */


define("hxValidator/hxValidator",["jquery"],function(a,b,c){var d=a("jquery"),e={messages:{required:"此项为必填项",minLength:"此项要求最少%s个字符长度",maxLength:"此项要求最多%s个字符长度",phone:"手机格式错误",email:"邮件格式错误",number:"此项只能输入数字",notAllNumber:"此项不能全为数字",match:"与%s输入不一致"},errorCallback:function(a){a.element.siblings(".icon").removeClass("icon-success").addClass("icon-error icon-inset")},successCallback:function(a){a.element.siblings(".icon").removeClass("icon-error").addClass("icon-success icon-inset")},focusCallback:function(a){a.element.siblings(".icon").removeClass("icon-error icon-success icon-inset")}},f=/^1[3-8]\d{9}$/,g=/^[0-9]+$/,h=/^[a-zA-Z0-9.!#$%&amp;'*+\-\/=?\^_`{|}~\-]+@[a-zA-Z0-9\-]+(?:\.[a-zA-Z0-9\-]{2,})+$/,i=function(a,b){var b=b||{};this.form=a instanceof d?a:d(a),this.fields={},this.errorsClass=b.errorsClass||".errors",this.hintsClass=b.hintsClass||".hints",this.wrapperClass=b.wrapperClass||".hxValidator-field",this.messages=d.extend({},e.messages,b.messages),this.errorCallback=b.errorCallback||e.errorCallback,this.successCallback=b.successCallback||e.successCallback,this.focusCallback=b.focusCallback||e.focusCallback,this._checkMethods=d.extend({},this._checkMethods,b.customCheckMethods);for(var c=this.form.find("input[type!=hidden][type!=submit]"),f=0;f<c.length;f++)this._addField(c[f]);for(var g in this.fields)if(this.fields.hasOwnProperty(g)){var h=this.fields[g];h.element.on("blur",d.proxy(this._validateField,this,h)),h.element.on("focus",d.proxy(this._focusField,this,h))}this.form.submit(d.proxy(this._validateForm,this)),this._hideAllHints()};i.prototype._validateForm=function(){var a=!1;for(var b in this.fields)if(this.fields.hasOwnProperty(b)){var c=this.fields[b];null===c.failed&&this._validateField(c),a=a||c.failed}return a?!1:!0},i.prototype._addField=function(a){var b=d(a);this.fields[b.attr("name")]={rules:b.data(),type:b.attr("type"),element:b,errors:b.siblings(this.errorsClass),hints:b.siblings(this.hintsClass),wrapper:b.parent(this.wrapperClass),value:null,failed:null}},i.prototype._validateField=function(a){var b=a.rules,c=null;if(a.value=a.element.val(),b.required&&this._checkMethods.required.apply(this,[a,!0]))return a.failed=!0,void this._addError(a,"required");for(var d in b)if(b.hasOwnProperty(d)&&"required"!==d)if(d.match(/Remote$/))c=d;else{var e=b[d];if(a.failed=this._checkMethods[d].apply(this,[a,e]),a.failed)return void this._addError(a,d,e)}if(c){var e=b[c];if(a.failed=this._checkMethods[c].apply(this,[a,e]),a.failed)return void this._addError(a,c,e)}a.failed=!1,this._addSuccess(a)},i.prototype._focusField=function(a){a.wrapper.hasClass("success")||(a.wrapper.removeClass("error"),a.hints.show(),a.errors.text(""),this.focusCallback(a))},i.prototype._addSuccess=function(a){a.wrapper.removeClass("error").addClass("success"),a.hints.hide(),a.errors.text(),this.successCallback(a)},i.prototype._addError=function(a,b,c){var d=this.messages[b];if(d.indexOf("%s")>0){var e="string"==typeof c&&c.indexOf("|")>0?c.split("|")[1]:c;d=d.replace("%s",e)}a.wrapper.removeClass("success").addClass("error"),a.hints.hide(),a.errors.text(d),this.errorCallback(a)},i.prototype._hideAllHints=function(){d(".hints").hide()},i.prototype._checkMethods={required:function(a,b){return b?!a.value||""===a.value||void 0===a.value:void 0},minLength:function(a,b){var c=a.value.replace(/[^\x00-\xff]/g,"***");return c.length<b},maxLength:function(a,b){var c=a.value.replace(/[^\x00-\xff]/g,"***");return c.length>b},phone:function(a,b){return b?!f.test(a.value):void 0},email:function(a,b){return b&&0!==a.value.length?!h.test(a.value):void 0},number:function(a,b){return b&&0!==a.value.length?!g.test(a.value):void 0},notAllNumber:function(a,b){return b&&0!==a.value.length?g.test(a.value):void 0},match:function(a,b){var c="string"==typeof b&&b.indexOf("|")>0?b.split("|")[0]:b,d=this.form[0][c];return d?a.value!==d.value:!0}},c.exports=i});